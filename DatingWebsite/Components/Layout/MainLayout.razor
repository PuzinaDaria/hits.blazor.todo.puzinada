@using DatingWebsite.Components.Pages
@inherits LayoutComponentBase

<div style="display: flex; min-height: 100vh;">
    <!-- Сайдбар -->
    <div style="width: 250px; background: #2c3e50; color: white;">
        <!-- Используем SimpleMenu -->
        <SimpleMenu />
    </div>

    <!-- Основной контент -->
    <div style="flex: 1; display: flex; flex-direction: column;">
        <!-- Верхняя панель (динамическая) -->
        <div id="topBar" style="background: white; padding: 15px 30px; border-bottom: 1px solid #eee; display: flex; justify-content: flex-end;">
            <!-- Содержимое будет обновлено через JavaScript -->
            <div id="topBarContent">
                @* <span style="color: #6c757d;">Загрузка...</span> *@
            </div>
        </div>

        <!-- Контент страницы -->
        <main style="flex: 1; padding: 30px; background: #f8f9fa;">
            @Body
        </main>
    </div>
</div>

<script>
    // Функция обновления верхней панели
    function updateTopBar() {
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        const topBarContent = document.getElementById('topBarContent');
        
        if (!topBarContent) return;
        
        if (isLoggedIn) {
            // Получаем данные пользователя
            let userName = 'Пользователь';
            try {
                const userJson = localStorage.getItem('currentUser');
                if (userJson) {
                    const user = JSON.parse(userJson);
                    userName = user.firstName || user.email || 'Пользователь';
                }
            } catch (error) {
                console.error('Ошибка при получении данных пользователя:', error);
            }
            
            // topBarContent.innerHTML = `
            //     <div style="display: flex; align-items: center; gap: 15px;">
            //         <div style="display: flex; align-items: center; gap: 8px; color: #28a745;">
            //             <span style="font-size: 18px;">✅</span>
            //             <span>Вы вошли как <strong>${userName}</strong></span>
            //         </div>
            //         <button onclick="logoutUser()" 
            //                 style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
            //             Выйти
            //         </button>
            //     </div>
            // `;
        } else {
            topBarContent.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 8px; color: #6c757d;">
                        <span style="font-size: 18px;">👤</span>
                        <span>Гость</span>
                    </div>
                    <a href="/login" style="background: #e75480; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 14px;">
                        Войти
                    </a>
                    <a href="/register" style="background: #17a2b8; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 14px;">
                        Регистрация
                    </a>
                </div>
            `;
        }
    }
    
    // Вызываем при загрузке
    document.addEventListener('DOMContentLoaded', function() {
        updateTopBar();
        
        // Обновляем при изменениях в localStorage
        window.addEventListener('storage', function(event) {
            if (event.key === 'isLoggedIn' || event.key === 'currentUser') {
                updateTopBar();
            }
        });
        
        // Обновляем при кликах
        document.addEventListener('click', function() {
            updateTopBar();
        });
    });
</script>